# ESP32-S3-0.42OLED Setup Guide

This guide provides specific setup instructions for the ESP32-S3-0.42OLED board with a built-in 0.42 inch OLED display for the Afterburner project.

## Board Overview

The ESP32-S3-0.42OLED is a development board featuring:

- **ESP32-S3 dual-core Xtensa LX7 processor**
- **WiFi and Bluetooth Low Energy (BLE)**
- **Built-in 0.42 inch OLED display** (128x64 pixels)
- **USB-C programming port**
- **RGB LED status indicator**
- **Multiple GPIO pins** for expansion

## Pin Assignments

### Essential Pins

| Pin    | Function            | Direction     | Component            |
| ------ | ------------------- | ------------- | -------------------- |
| GPIO0  | BOOT                | Input         | Programming mode     |
| GPIO1  | I2C SCL (SH1.0)     | Output        | External I2C clock   |
| GPIO2  | I2C SDA (SH1.0)     | Bidirectional | External I2C data    |
| GPIO5  | UART TX             | Output        | Serial communication |
| GPIO6  | LED Data            | Output        | WS2812B strip        |
| GPIO16 | UART RX             | Input         | Serial communication |
| GPIO18 | Throttle Input      | Input         | PWM signal           |
| GPIO39 | RGB LED             | Output        | Status indicator     |
| GPIO40 | OLED SCL (Built-in) | Output        | Internal OLED        |
| GPIO41 | OLED SDA (Built-in) | Bidirectional | Internal OLED        |

### Available Pins

- **GPIO7**: Available for future use
- **GPIO8**: Available for future use
- **GPIO9**: Available for future use
- **GPIO17**: Available for future use
- **GPIO35**: Available for future use
- **GPIO36**: Available for future use
- **GPIO37**: Available for future use

## Hardware Connections

### 1. OLED Display (Built-in)

```
No external connections needed!
The 0.42 inch OLED is built into the board and uses:
- GPIO40 (SCL) - Internal
- GPIO41 (SDA) - Internal
- 3.3V power - Internal
- GND - Internal
```

### 2. Navigation Button

```
Button Pin 1 ──── GPIO2
Button Pin 2 ──── GND

Note: GPIO2 is also used for external I2C SDA
```

### 3. Throttle Input

```
Signal Wire ──── GPIO18
Power ──── 3.3V or 5V (as needed)
Ground ──── GND
```

### 4. WS2812B LED Strip

```
Data In ──── GPIO6
VCC ──── 5V (5V pin or external supply)
GND ──── GND
```

## Power Requirements

### Board Power

- **USB-C**: 5V input for programming and power
- **5V Pin**: 5V output (max ~1A)
- **3.3V Pin**: 3.3V regulated output (max ~500mA)
- **Battery Input**: Optional battery backup

### Component Power

- **Built-in OLED**: 3.3V, ~20mA (internal)
- **Navigation Button**: 3.3V, negligible current
- **Throttle Input**: 3.3V or 5V (depending on source)
- **LED Strip**: 5V, ~60mA per LED at full brightness

### Power Recommendations

- **For LED strips with >20 LEDs**: Use external 5V power supply
- **For LED strips with ≤20 LEDs**: Can use 5V pin
- **Always use external power for LED strips with >50 LEDs**

## Programming Setup

### 1. Install PlatformIO

```bash
# Install PlatformIO Core
pip install platformio

# Or install PlatformIO IDE extension in VS Code
```

### 2. Board Configuration

The project is configured for ESP32-S3-0.42OLED in `platformio.ini`:

```ini
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
```

### 3. Upload Code

```bash
# Navigate to firmware directory
cd firmware

# Build and upload
pio run --target upload

# Monitor serial output
pio device monitor
```

## Built-in OLED Configuration

### Display Specifications

- **Size**: 0.42 inch
- **Resolution**: 128x64 pixels
- **Interface**: I2C (internal)
- **Pins**: GPIO40 (SCL), GPIO41 (SDA)
- **Power**: 3.3V (internal)

### I2C Setup

```cpp
// In oled_display.cpp
Wire.begin(40, 41); // SDA=40, SCL=41 for built-in OLED
```

### No External I2C Address Needed

Since the OLED is built-in, you don't need to worry about I2C addresses or external connections.

## Troubleshooting

### Common Issues

#### 1. Built-in OLED Not Displaying

- The OLED should work automatically - no external connections needed
- Check if the board is powered correctly
- Verify the firmware uploaded successfully
- Check serial monitor for error messages

#### 2. Button Not Responding

- Verify GPIO2 connection
- Check button wiring (one pin to GPIO2, other to GND)
- Ensure internal pull-up is enabled
- Note: GPIO2 is also used for external I2C

#### 3. LEDs Not Lighting

- Check data connection to GPIO6
- Verify power supply adequacy
- Check LED strip direction (arrow indicator)
- Ensure proper 5V power connection

#### 4. Throttle Not Reading

- Verify GPIO18 connection
- Check PWM signal source
- Ensure proper power and ground connections

#### 5. Upload Issues

- Hold BOOT button (GPIO0) during upload
- Check USB-C cable quality
- Verify board selection in PlatformIO
- Check COM port selection

### ESP32-S3-0.42OLED Specific Issues

1. **Built-in OLED**: Should work without any external connections
2. **Pin conflicts**: GPIO2 is used for both navigation button and external I2C
3. **Power limitations**: Check current requirements for LED strips
4. **Upload issues**: Hold BOOT button during upload

## Verification Procedure

### 1. Basic Board Verification

```bash
# Upload basic blink sketch
pio run --target upload

# Check serial monitor for startup messages
pio device monitor
```

### 2. Component Verification

1. **Built-in OLED**: Should show startup message automatically
2. **Button**: Press to advance OLED pages
3. **Throttle**: Move input to see value changes
4. **LEDs**: Should light up with throttle movement

### 3. BLE Verification

1. Scan for "ABurner" device
2. Connect and verify settings changes
3. Verify OLED updates with new settings

## Pin Limitations and Considerations

### ESP32-S3-0.42OLED Constraints

- **GPIO2 conflict**: Used for both navigation button and external I2C
- **Built-in OLED**: GPIO40 and GPIO41 are not available for external use
- **RGB LED**: GPIO39 can be used for status indication
- **Power limitations**: Limited current output on 5V and 3.3V pins

### Future Expansion

- **GPIO7-GPIO9**: Available for additional sensors or controls
- **GPIO17**: Available for additional inputs/outputs
- **GPIO35-GPIO37**: Available for SPI or other protocols
- **External I2C**: GPIO1/2 via SH1.0 4P connector

## Board-Specific Features

### Built-in OLED Display

- **No external wiring required**
- **Automatic initialization**
- **128x64 pixel resolution**
- **I2C communication (internal)**

### RGB LED Indicator

- **GPIO39 control**
- **Can be used for system status**
- **Three-color capability**

### External I2C Connector

- **SH1.0 4P connector**
- **GPIO1 (SCL) and GPIO2 (SDA)**
- **3.3V and GND provided**
- **Useful for additional I2C devices**

### Battery Backup

- **Optional battery input**
- **Maintains settings during power loss**
- **Automatic switching**

## Resources

- [ESP32-S3 Technical Reference Manual](https://www.espressif.com/sites/default/files/documentation/esp32-s3_technical_reference_manual_en.pdf)
- [ESP32-S3 Datasheet](https://www.espressif.com/sites/default/files/documentation/esp32-s3_datasheet_en.pdf)
- [PlatformIO ESP32-S3 Guide](https://docs.platformio.org/en/latest/platforms/espressif32.html)
- [U8g2 OLED Library](https://github.com/olikraus/U8g2_Arduino)
- [FastLED Library](https://github.com/FastLED/FastLED)
